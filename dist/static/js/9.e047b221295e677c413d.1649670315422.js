webpackJsonp([9],{GcUw:function(e,t){},ZXub:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("IHPB"),r=a.n(l),n=a("HzJ8"),o=a.n(n),i=a("Fdjv"),u=a("dNAe"),c=a("ZoQJ"),s=[{key:1,value:"招待费：餐饮、礼品发票、烟酒发票等"},{key:2,value:"交通费：打车租车票、地铁票、公交票"},{key:3,value:"差旅费：住宿、火车票、飞机票、长途汽车票"},{key:4,value:"福利费：餐饮、食品发票等"},{key:5,value:"通讯费：电话费、手机费"},{key:6,value:"办公费：办公用品发票、图书发票、日用品发票"},{key:7,value:"培训费：培训费发票、培训费收据"},{key:8,value:"会议费：会议费发票"},{key:9,value:"快递费：快递费发票"},{key:10,value:"咨询费：中介服务发票"},{key:11,value:"业务宣传费（印刷传单费用发票等）"},{key:12,value:"车辆费：停车、洗车、保养、加油发票"},{key:13,value:"保险费：保险发票"},{key:14,value:"服务费：个人垫付对公付款"},{key:15,value:"固定资产"}],m={data:function(){var e=this;return{leagueForm:{title:"",detail:[{use_type:4,cnt:"",total_amount:""}],company_user:[]},userList:[],rules:{title:[{required:!0,message:"请输入流程主题",trigger:"blur"}],payee_name:[{required:!0,message:"请输入收款人姓名",trigger:"blur"}],payee_card:[{required:!0,message:"请输入收款卡号",trigger:"blur"}],pay_bank:[{required:!0,message:"请输入收款账号开户行",trigger:"blur"}],open_city:[{required:!0,message:"请输入收款城市",trigger:"blur"}],file:[{required:!0,validator:function(t,a,l){e.leagueForm.company_user[0].voucher_files&&e.leagueForm.company_user[0].voucher_files.length>0?l():l(new Error("请上传附件"))},trigger:"change"}],file1:[{required:!0,validator:function(t,a,l){e.leagueForm.company_user[0].attachment&&e.leagueForm.company_user[0].attachment.length>0?l():l(new Error("请上传图集"))},trigger:"change"}],file2:[{required:!0,validator:function(t,a,l){e.leagueForm.company_user[0].invoice_files&&e.leagueForm.company_user[0].invoice_files.length>0?l():l(new Error("请上传发票"))},trigger:"change"}]},fileList:[],totalUser:0,isChange:!0,dialogVisible:!1,dialogImageUrl:"",userTypeKeys:s}},computed:{numTotal:function(){var e=0,t=!0,a=!1,l=void 0;try{for(var r,n=o()(this.leagueForm.detail);!(t=(r=n.next()).done);t=!0){var i=r.value;e+=Number(i.total_amount||0)}}catch(e){a=!0,l=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw l}}return e},upcaseTotal:function(){return Object(i.c)(this.numTotal)||"零元"}},created:function(){var e=this;1==this.$route.query.type?this.leagueForm.title="日常团建报销":this.leagueForm.title="定向团建报销",this.$http.get(1==this.$route.query.type?"/get_baoxiao_info":"direction/get_baoxiao_info",{act_id:this.$route.query.id}).then(function(t){if(t){e.totalUser=0,e.userList=t.user_name;var a=!0,l=!1,r=void 0;try{for(var n,i=o()(t.company_user);!(a=(n=i.next()).done);a=!0){var u=n.value;e.totalUser+=Number(u.num||0)}}catch(e){l=!0,r=e}finally{try{!a&&i.return&&i.return()}finally{if(l)throw r}}var c=!0,s=!1,m=void 0;try{for(var p,d=o()(t.company_user);!(c=(p=d.next()).done);c=!0){var _=p.value;_.attachment=[],_.voucher_files=[],_.invoice_files=[],_.pay_money=e.calcCompanyTotal(_)}}catch(e){s=!0,m=e}finally{try{!c&&d.return&&d.return()}finally{if(s)throw m}}e.leagueForm.company_user=t.company_user}})},methods:{back:function(){var e=this;this.$confirm("确定返回吗？返回后已填写数据不会保留","返回提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.go(-1)}).catch(function(){})},addDetail:function(){this.leagueForm.detail=[].concat(r()(this.leagueForm.detail),[{use_type:"",cnt:"",total_amount:""}])},delDetail:function(e){this.leagueForm.detail.splice(e,1)},payPriceChange:function(e){e.total_amount=e.total_amount.replace(/[^\d\.]/g,""),e.total_amount=e.total_amount.replace(/^\./g,""),e.total_amount=e.total_amount.replace(/\.{2,}/g,"."),e.total_amount=e.total_amount.replace(".","$#$").replace(/\./g,"").replace("$#$","."),e.total_amount=e.total_amount.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3");var t=!0,a=!1,l=void 0;try{for(var r,n=o()(this.leagueForm.company_user);!(t=(r=n.next()).done);t=!0){var i=r.value;i.pay_money=this.calcCompanyTotal(i)}}catch(e){a=!0,l=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw l}}},payPriceChange1:function(e){e.pay_money=e.pay_money.replace(/[^\d\.]/g,""),e.pay_money=e.pay_money.replace(/^\./g,""),e.pay_money=e.pay_money.replace(/\.{2,}/g,"."),e.pay_money=e.pay_money.replace(".","$#$").replace(/\./g,"").replace("$#$","."),e.pay_money=e.pay_money.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")},calcCompanyTotal:function(e){return(this.numTotal*(e.num/this.totalUser)).toFixed(2)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=!0,l=!1,n=void 0;try{for(var i,u=o()(t.leagueForm.detail);!(a=(i=u.next()).done);a=!0){var c=i.value;if(!c.use_type||""===c.cnt||""===c.total_amount)return t.$message("报销明细请填写完整"),!1}}catch(e){l=!0,n=e}finally{try{!a&&u.return&&u.return()}finally{if(l)throw n}}var s=1==t.$route.query.type?"/add_approve":"/direction/add_approve",m={act_id:t.$route.query.id,payee_name:t.leagueForm.payee_name,payee_card:t.leagueForm.payee_card,payee_bank:t.leagueForm.pay_bank,open_city:t.leagueForm.open_city,total_money:t.numTotal,str_total_money:t.upcaseTotal,title:t.leagueForm.title,detail:t.leagueForm.detail,pay_company:[].concat(r()(t.leagueForm.company_user.map(function(e){return{pay_company_id:e.company_id,pay_company_name:e.company_name,pay_user_num:e.num,user_ids:e.user_ids,pay_money:e.pay_money,remark:e.remark||"",attachment:[].concat(r()(e.attachment.map(function(e){return{file_name:e.name,file_path:e.url}}))),voucher_files:[].concat(r()(e.voucher_files.map(function(e){return{file_name:e.name,file_path:e.url}}))),invoice_files:[].concat(r()(e.invoice_files.map(function(e){return{file_name:e.name,file_path:e.url}})))}})))};return 2==t.$route.query.type&&(m.travel_attachment=t.fileList.map(function(e){return{file_name:e.name,file_path:e.path}})),t.$http.post(s,m).then(function(e){e&&(t.$message({type:"success",message:"报销发起成功"}),t.$router.go(-1))}),!0}return!1})},handlePreview:function(e){},handleRemove:function(e,t){this.leagueForm.company_user[e.belong].voucher_files=[].concat(r()(t))},handleChange:function(e,t){},beforeUpload:function(e){},uploadAttach:function(e){var t=this;Object(u.q)(e.file).then(function(a){if(a){t.$refs.ruleForm.clearValidate("file");var l={name:e.file.name,url:a.path,belong:e.data.index};t.leagueForm.company_user[e.data.index].voucher_files=[].concat(r()(t.leagueForm.company_user[e.data.index].voucher_files),[l])}})},handlePreview2:function(e){},handleRemove2:function(e,t){this.leagueForm.company_user[e.belong].invoice_files=[].concat(r()(t))},handleChange2:function(e,t){},beforeUpload2:function(e){},uploadAttach2:function(e){var t=this;Object(u.q)(e.file).then(function(a){if(a){t.$refs.ruleForm.clearValidate("file");var l={name:e.file.name,url:a.path,belong:e.data.index};t.leagueForm.company_user[e.data.index].invoice_files=[].concat(r()(t.leagueForm.company_user[e.data.index].invoice_files),[l])}})},uploadAttach1:function(e){var t=this;Object(u.q)(e.file).then(function(a){a&&t.fileList.push({name:e.file.name,path:a.path})})},beforeUploadImg1:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传图片大小不能超过 2MB!"),t},uploadImage1:function(e){var t=this;Object(u.q)(e.file).then(function(a){if(a){t.$refs.ruleForm.clearValidate("file1");var l={name:e.file.name,url:a.path};t.leagueForm.company_user[0].attachment=[].concat(r()(t.leagueForm.company_user[0].attachment),[l])}})},handleRemove1:function(e,t){var a=this.leagueForm.company_user[0].attachment.findIndex(function(t){return t.uid==e.uid});this.leagueForm.company_user[0].attachment.splice(a,1)},handleChange1:function(e,t){},handlePictureCardPreview1:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},downloadExcel:function(){window.open(c.a+"/file/expense-template.xlsx")}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"out_wrap"},[a("div",{staticClass:"center mb35 hidden"},[a("el-button",{staticClass:"fl",attrs:{size:"mini",round:""},on:{click:e.back}},[a("i",{staticClass:"el-icon-arrow-left"}),e._v("返回")])],1),e._v(" "),a("el-form",{ref:"ruleForm",staticClass:"mb35 wd700",attrs:{model:e.leagueForm,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{"label-width":"75px"}},[a("span",{staticClass:"fs18 bold"},[e._v("团建报销")])]),e._v(" "),a("el-form-item",{attrs:{label:"流程主题",prop:"title"}},[a("el-input",{attrs:{type:"text",placeholder:"流程主题",disabled:""},model:{value:e.leagueForm.title,callback:function(t){e.$set(e.leagueForm,"title",t)},expression:"leagueForm.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"收款信息",prop:"payee_name"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入收款人姓名",clearable:""},model:{value:e.leagueForm.payee_name,callback:function(t){e.$set(e.leagueForm,"payee_name",t)},expression:"leagueForm.payee_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"payee_card"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入收款卡号",clearable:""},on:{input:function(t){e.leagueForm.payee_card=e.leagueForm.payee_card.replace(/\D/g,"")}},model:{value:e.leagueForm.payee_card,callback:function(t){e.$set(e.leagueForm,"payee_card",t)},expression:"leagueForm.payee_card"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"pay_bank"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入收款账号开户行",clearable:""},model:{value:e.leagueForm.pay_bank,callback:function(t){e.$set(e.leagueForm,"pay_bank",t)},expression:"leagueForm.pay_bank"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"open_city"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入收款城市",clearable:""},model:{value:e.leagueForm.open_city,callback:function(t){e.$set(e.leagueForm,"open_city",t)},expression:"leagueForm.open_city"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"报销明细",required:""}},[e._l(e.leagueForm.detail,function(t,l){return a("div",{key:l,staticClass:"border-item mb15"},[a("el-select",{staticClass:"w100 mb22",attrs:{clearable:"",filterable:"",disabled:"",placeholder:"请选择报销明细"},model:{value:t.use_type,callback:function(a){e.$set(t,"use_type",a)},expression:"item.use_type"}},e._l(e.userTypeKeys,function(e){return a("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}),1),e._v(" "),a("el-input",{staticClass:"w100 mb22",attrs:{type:"text",placeholder:"请输入发票张数"},on:{input:function(e){t.cnt=t.cnt.replace(/\D/g,"")}},model:{value:t.cnt,callback:function(a){e.$set(t,"cnt",a)},expression:"item.cnt"}},[a("i",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("张")])]),e._v(" "),a("el-input",{staticClass:"w100 mb15",attrs:{type:"text",placeholder:"需要报销金额（金额只能小于或等于发票上的金额/可用团建费）"},on:{input:function(a){return e.payPriceChange(t)}},model:{value:t.total_amount,callback:function(a){e.$set(t,"total_amount",a)},expression:"item.total_amount"}},[a("i",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("元")])]),e._v(" "),0!=l?a("a",{staticClass:"del",on:{click:function(t){return e.delDetail(l)}}},[e._v("删除")]):e._e(),e._v(" "),0==l?a("div",{staticStyle:{width:"33px"}}):e._e()],1)}),e._v(" "),a("a",{staticClass:"active_color mb15",on:{click:e.addDetail}},[e._v("增加明细")]),e._v(" "),a("div",{staticClass:"bf1 flex",staticStyle:{padding:"6px"}},[a("div",{staticClass:"flex1"},[e._v("合计")]),e._v(" "),a("div",{staticClass:"flex1"},[e._v(e._s(e.upcaseTotal))]),e._v(" "),a("div",{staticClass:"flex1"},[e._v(e._s(e.numTotal)+"元")])])],2),e._v(" "),a("el-form-item",{attrs:{label:"付款公司",required:""}},e._l(e.leagueForm.company_user,function(t,l){return a("div",{key:l,staticClass:"mb15"},[a("el-input",{staticClass:"w100 mb22",attrs:{type:"text",disabled:"",placeholder:"付款公司",readonly:""},model:{value:t.company_name2,callback:function(a){e.$set(t,"company_name2",a)},expression:"item.company_name2"}}),e._v(" "),a("el-popover",{attrs:{placement:"top",width:e.userList.length>=30?700:300,trigger:"click"}},[a("h4",{staticClass:"user_title"},[e._v("参与员工")]),e._v(" "),a("div",{staticClass:"usrtlist"},e._l(e.userList,function(t){return a("el-tag",{key:t},[e._v(e._s(t))])}),1),e._v(" "),a("div",{attrs:{slot:"reference"},slot:"reference"},[a("el-input",{staticClass:"w100 mb22",attrs:{type:"text",disabled:"",placeholder:"参与员工"},model:{value:t.num,callback:function(a){e.$set(t,"num",a)},expression:"item.num"}},[a("i",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("人")])])],1)]),e._v(" "),a("el-input",{staticClass:"w100 mb22",attrs:{type:"text",disabled:"",placeholder:"付款金额"},on:{input:function(a){return e.payPriceChange1(t)}},model:{value:t.pay_money,callback:function(a){e.$set(t,"pay_money",a)},expression:"item.pay_money"}}),e._v(" "),a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入备注",resize:"none"},model:{value:t.remark,callback:function(a){e.$set(t,"remark",a)},expression:"item.remark"}})],1)}),0),e._v(" "),2!=e.$route.query.type?a("el-form-item",{attrs:{label:"发票",prop:"file2"}},e._l(e.leagueForm.company_user,function(t,l){return a("div",{key:l,staticClass:"mb22"},[a("div",[a("el-upload",{attrs:{action:"#",multiple:!1,"show-file-list":"","auto-upload":!0,"on-preview":e.handlePreview2,"on-remove":e.handleRemove2,"on-change":e.handleChange2,"before-upload":e.beforeUpload2,"file-list":t.invoice_files,"http-request":e.uploadAttach2,data:{index:l}}},[a("a",{staticClass:"active_color"},[e._v("添加附件")])])],1)])}),0):e._e(),e._v(" "),a("el-form-item",{attrs:{label:2==e.$route.query.type?"报销票务相关附件":"报销单",prop:"file"}},e._l(e.leagueForm.company_user,function(t,l){return a("div",{key:l,staticClass:"mb22 pr"},[a("div",[a("el-upload",{attrs:{action:"#",multiple:!1,"show-file-list":"","auto-upload":!0,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-change":e.handleChange,"before-upload":e.beforeUpload,"file-list":t.voucher_files,"http-request":e.uploadAttach,data:{index:l}}},[a("a",{staticClass:"active_color"},[e._v("添加附件")])])],1),e._v(" "),a("div",{staticClass:"download-wrap pa"},[a("el-button",{attrs:{type:"text"},on:{click:e.downloadExcel}},[e._v("下载模板")])],1)])}),0),e._v(" "),a("el-form-item",{attrs:{label:"团建图集",prop:"file1"}},e._l(e.leagueForm.company_user,function(t,l){return a("div",{key:l,staticClass:"mb22"},[a("el-upload",{attrs:{action:"#",multiple:!1,"show-file-list":"",accept:"image/png, image/jpeg, image/jpg","list-type":"picture-card","auto-upload":!0,"on-preview":e.handlePictureCardPreview1,"on-remove":e.handleRemove1,"on-change":e.handleChange1,"before-upload":e.beforeUploadImg1,"file-list":t.attachment,"http-request":e.uploadImage1}},[a("i",{staticClass:"el-icon-plus"})])],1)}),0),e._v(" "),a("el-form-item",[e.isChange?a("el-button",{staticClass:"w160",attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("提交")]):a("hr")],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl}})])],1)},staticRenderFns:[]};var d=a("C7Lr")(m,p,!1,function(e){a("GcUw")},"data-v-d5928e14",null);t.default=d.exports}});
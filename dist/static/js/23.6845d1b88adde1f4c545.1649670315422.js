webpackJsonp([23],{A10Y:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("4YfN"),l=a.n(r),s=a("dNAe"),i={data:function(){return{leagueForm:{name:"",type:"",user_ids:[],security_ids:[],act_date:"",desc:"",location:""},rules:{name:[{required:!0,message:"请输入团建主题",trigger:"change"}],type:[{required:!0,message:"请选择团建形式",trigger:"change"}],act_date:[{required:!0,message:"请选择团建时间",trigger:"change"}],user_ids:[{required:!0,message:"请选择团建人员",trigger:"change"}],security_ids:[{required:!0,message:"请选择安全员",trigger:"change"}],location:[{required:!0,message:"请输入地点",trigger:"change"}]},optionArr:[],userList:[],securityList:[],props:{checkStrictly:!1,label:"name",emitPath:!1,multiple:!0}}},created:function(){var e=this;this.leagueForm.user_ids.push(JSON.parse(localStorage.getItem("info")).info.user_id),Object(s.f)().then(function(t){t&&(e.optionArr=t)}),Object(s.g)().then(function(t){t&&(e.userList=t)})},methods:{back:function(){var e=this;this.$confirm("确定返回吗？返回后已填写数据不会保留","返回提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.go(-1)}).catch(function(){})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(11==t.leagueForm.type){var a=t.leagueForm.user_ids.length%30==0?parseInt(t.leagueForm.user_ids.length/30):parseInt(t.leagueForm.user_ids.length/30)+1;if(t.leagueForm.security_ids.length!==a)return t.$message.warning("每30个参与者就需要1个安全员"),!1}if(!e)return!1;var r=l()({},t.leagueForm,{start_date:t.leagueForm.act_date[0],end_date:t.leagueForm.act_date[1],user_ids:t.leagueForm.user_ids.toString(),security_ids:t.leagueForm.security_ids.toString(),location:t.leagueForm.location});delete r.act_date,t.$http.post("/direction/add_activity",r).then(function(e){e&&(t.$message({type:"success",message:"发起成功"}),t.$router.go(-1))})})},typeChange:function(e){if(11!=e)return this.leagueForm.security_ids=[],this.securityList=[],!1;var t=this.$refs.cascader.getCheckedNodes().filter(function(e){return!e.hasChildren});this.securityList=t.map(function(e){return{label:e.label,value:e.value}})},changeSelect:function(e){var t=this,a=[];e.forEach(function(e){t.$refs.cascader.getCheckedNodes().findIndex(function(t){return t.value===e})>-1&&(a.push(t.$refs.cascader.getCheckedNodes().find(function(t){return t.value===e})),t.totalMoney+=Number(t.$refs.cascader.getCheckedNodes().find(function(t){return t.value===e}).data.last_money))}),this.securityList=a.map(function(e){return{label:e.label,value:e.value}})},removeTag:function(e){this.leagueForm.security_ids=this.leagueForm.security_ids.filter(function(t){return t!==e})}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"out_wrap"},[a("div",{staticClass:"center mb35 hidden"},[a("el-button",{staticClass:"fl",attrs:{size:"mini",round:""},on:{click:e.back}},[a("i",{staticClass:"el-icon-arrow-left"}),e._v("返回")])],1),e._v(" "),a("el-form",{ref:"ruleForm",staticClass:"mb35 wd700",attrs:{model:e.leagueForm,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{"label-width":"75px"}},[a("span",{staticClass:"fs18 bold"},[e._v("发起定向团建")])]),e._v(" "),a("el-form-item",{attrs:{label:"团建主题",prop:"name"}},[a("el-input",{attrs:{type:"text",placeholder:"部门+主题+内容，例如总裁办秘书组迎新团建去聚餐",clearable:"","show-word-limit":""},model:{value:e.leagueForm.name,callback:function(t){e.$set(e.leagueForm,"name",t)},expression:"leagueForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"团建形式",prop:"type"}},[a("el-select",{staticClass:"w100",attrs:{clearable:"",filterable:"",placeholder:"请选择团建形式"},on:{change:e.typeChange},model:{value:e.leagueForm.type,callback:function(t){e.$set(e.leagueForm,"type",t)},expression:"leagueForm.type"}},e._l(e.optionArr,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"团建人员",prop:"user_ids"}},[a("el-cascader",{ref:"cascader",staticClass:"w100 inline",attrs:{options:e.userList,props:e.props,clearable:"","show-all-levels":!1},on:{change:e.changeSelect,"remove-tag":e.removeTag},model:{value:e.leagueForm.user_ids,callback:function(t){e.$set(e.leagueForm,"user_ids",t)},expression:"leagueForm.user_ids"}})],1),e._v(" "),11==e.leagueForm.type?a("el-form-item",{attrs:{label:"安全员",prop:"security_ids"}},[a("el-select",{staticClass:"w100 inline",attrs:{clearable:"",multiple:"",placeholder:"请选择"},model:{value:e.leagueForm.security_ids,callback:function(t){e.$set(e.leagueForm,"security_ids",t)},expression:"leagueForm.security_ids"}},e._l(e.securityList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("div",[a("span",{staticStyle:{"padding-right":"50px"}},[e._v("已选团建人数："+e._s(e.leagueForm.user_ids.length))])])]),e._v(" "),a("el-form-item",{attrs:{label:"地点",prop:"location"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入地点",clearable:"","show-word-limit":""},model:{value:e.leagueForm.location,callback:function(t){e.$set(e.leagueForm,"location",t)},expression:"leagueForm.location"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"团建时间",prop:"act_date"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",editable:!1,clearable:"","value-format":"yyyy-MM-dd"},model:{value:e.leagueForm.act_date,callback:function(t){e.$set(e.leagueForm,"act_date",t)},expression:"leagueForm.act_date"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"团建描述"}},[a("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入团建描述",resize:"none"},model:{value:e.leagueForm.desc,callback:function(t){e.$set(e.leagueForm,"desc",t)},expression:"leagueForm.desc"}})],1),e._v(" "),a("el-form-item",[a("el-button",{staticClass:"w160",attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var n=a("C7Lr")(i,o,!1,function(e){a("g+0m")},"data-v-021c6ea4",null);t.default=n.exports},"g+0m":function(e,t){}});